<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulating covariates and outcomes • simsam</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulating covariates and outcomes">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simsam</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Covariates_and_outcomes.html">Simulating covariates and outcomes</a>
    </li>
    <li>
      <a href="../articles/Creating-spatial-proxies.html">Creating spatial proxies</a>
    </li>
    <li>
      <a href="../articles/Sampling.html">Sampling</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><script src="Covariates_and_outcomes_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simulating covariates and outcomes</h1>
                        <h4 data-toc-skip class="author">Jakub Nowosad</h4>
            
            <h4 data-toc-skip class="date">2025-01-02</h4>
      

      <div class="hidden name"><code>Covariates_and_outcomes.Rmd</code></div>

    </div>

    
    
<p>Let’s start by attaching the necessary packages and setting the seed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">simsam</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.8.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">-</span><span class="fl">12</span><span class="op">-</span><span class="fl">13</span><span class="op">)</span></span></code></pre></div>
<p>Next, we specify a raster template for the simulations.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rast_grid</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">200</span>, ymin <span class="op">=</span> <span class="fl">0</span>, ymax <span class="op">=</span> <span class="fl">200</span>, </span>
<span>                        ncols <span class="op">=</span> <span class="fl">200</span>, nrows <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="simulate">Simulate<a class="anchor" aria-label="anchor" href="#simulate"></a>
</h2>
<p>We can simulate any number of covariates based on specified parameters using the <code><a href="../reference/sim_covariates.html">sim_covariates()</a></code> function. This function is rather flexible when it comes to which parameters to use, as it can take a range or a complete variogram model, and some additional simulation arguments. This is shown below.</p>
<p>The first example shows the use of just a <code>range</code> parameter to simulate four covariates for the provided raster grid. The rest of the arguments (e.g., <code>beta</code> representing the average value of the field, <code>nmax</code> representing the maximum number of points to simulate, and <code>psill</code> representing the sill of the variogram model) are set to default values.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covariates_one</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_covariates.html">sim_covariates</a></span><span class="op">(</span><span class="va">rast_grid</span>, range <span class="op">=</span> <span class="fl">10</span>, n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/panel.html" class="external-link">panel</a></span><span class="op">(</span><span class="va">covariates_one</span>, nr <span class="op">=</span> <span class="fl">1</span>, col.main <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Covariates_and_outcomes_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>The second example uses a complete variogram model to simulate four covariates for the provided raster grid. Here, we specify not only the range but also the model type (exponential) and the sill of the variogram model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covariates_two</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_covariates.html">sim_covariates</a></span><span class="op">(</span><span class="va">rast_grid</span>, vgm <span class="op">=</span> <span class="fu">gstat</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/gstat/reference/vgm.html" class="external-link">vgm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"Exp"</span>, psill <span class="op">=</span> <span class="fl">1</span>, range <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/panel.html" class="external-link">panel</a></span><span class="op">(</span><span class="va">covariates_two</span>, nr <span class="op">=</span> <span class="fl">1</span>, col.main <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Covariates_and_outcomes_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The third example uses a nugget effect to simulate four covariates without any spatial correlation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covariates_three</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_covariates.html">sim_covariates</a></span><span class="op">(</span><span class="va">rast_grid</span>, vgm <span class="op">=</span> <span class="fu">gstat</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/gstat/reference/vgm.html" class="external-link">vgm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"Nug"</span>, psill <span class="op">=</span> <span class="fl">2</span>, range <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/panel.html" class="external-link">panel</a></span><span class="op">(</span><span class="va">covariates_three</span>, nr <span class="op">=</span> <span class="fl">1</span>, col.main <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Covariates_and_outcomes_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>The last example creates a single simulation of a binary outcome (<code>indicator = TRUE</code>) based on a specified variogram model and a beta value. The result of such a simulation depends on the specified variogram model and the beta value.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covariates_four</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_covariates.html">sim_covariates</a></span><span class="op">(</span><span class="va">rast_grid</span>, vgm <span class="op">=</span> <span class="fu">gstat</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/gstat/reference/vgm.html" class="external-link">vgm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"Exp"</span>, psill <span class="op">=</span> <span class="fl">10</span>, range <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                 beta <span class="op">=</span> <span class="fl">30</span>, indicators <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">covariates_four</span>, nr <span class="op">=</span> <span class="fl">1</span>, col.main <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Covariates_and_outcomes_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="blend">Blend<a class="anchor" aria-label="anchor" href="#blend"></a>
</h2>
<p>The <code><a href="../reference/sim_covariates.html">sim_covariates()</a></code> creates new rasters. Now, we can blend these rasters to create new outcomes with the <code><a href="../reference/blend_rasters.html">blend_rasters()</a></code> function. This function accepts one or more <code>SpatRaster</code> objects, and a formula that specifies how to combine them. Let’s try it out on a few examples.</p>
<p>The first new raster is based on the first set of covariates and a formula that combines them by adding them together.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outcome_one</span> <span class="op">=</span> <span class="fu">simsam</span><span class="fu">::</span><span class="fu"><a href="../reference/blend_rasters.html">blend_rasters</a></span><span class="op">(</span><span class="va">covariates_one</span>, <span class="op">~</span> <span class="va">cov1</span> <span class="op">+</span> <span class="va">cov2</span> <span class="op">+</span> <span class="va">cov3</span> <span class="op">+</span> <span class="va">cov4</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">outcome_one</span><span class="op">)</span></span></code></pre></div>
<p><img src="Covariates_and_outcomes_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>The <code><a href="../reference/blend_rasters.html">blend_rasters()</a></code> function can also be used to further blend the outcomes with additional covariates. Here, we are adding a random noise (<code>cov1</code> from <code>covariates_three</code>) to the outcome.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outcome_two</span> <span class="op">=</span> <span class="fu">simsam</span><span class="fu">::</span><span class="fu"><a href="../reference/blend_rasters.html">blend_rasters</a></span><span class="op">(</span><span class="va">outcome_one</span>, <span class="op">~</span> <span class="va">outcome</span> <span class="op">+</span> <span class="va">cov1</span>, <span class="va">covariates_three</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">outcome_two</span><span class="op">)</span></span></code></pre></div>
<p><img src="Covariates_and_outcomes_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>The third example shows how to blend the first created outcome with a binary covariate (<code>cov1</code> from <code>covariates_four</code>). Additionally, it also highlights the flexibility of the formula notation, which allows, for example, the use of various mathematical operations and constants.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outcome_three</span> <span class="op">=</span> <span class="fu">simsam</span><span class="fu">::</span><span class="fu"><a href="../reference/blend_rasters.html">blend_rasters</a></span><span class="op">(</span><span class="va">outcome_one</span>, <span class="op">~</span> <span class="va">outcome</span> <span class="op">*</span> <span class="op">(</span><span class="va">cov1</span> <span class="op">+</span> <span class="fl">0.2</span><span class="op">)</span>, <span class="va">covariates_four</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">outcome_three</span><span class="op">)</span></span></code></pre></div>
<p><img src="Covariates_and_outcomes_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Finally, the last example shows that the <code><a href="../reference/blend_rasters.html">blend_rasters()</a></code> function can be used in a pipe-like manner.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outcome_four</span> <span class="op">=</span> <span class="fu">simsam</span><span class="fu">::</span><span class="fu"><a href="../reference/blend_rasters.html">blend_rasters</a></span><span class="op">(</span><span class="va">covariates_two</span>, <span class="op">~</span> <span class="va">cov1</span> <span class="op">+</span> <span class="va">cov2</span> <span class="op">*</span> <span class="va">cov3</span> <span class="op">+</span> <span class="va">cov4</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">simsam</span><span class="fu">::</span><span class="fu"><a href="../reference/blend_rasters.html">blend_rasters</a></span><span class="op">(</span><span class="op">~</span> <span class="va">outcome</span> <span class="op">*</span> <span class="op">(</span><span class="va">cov1</span> <span class="op">+</span> <span class="fl">0.2</span><span class="op">)</span>, <span class="va">covariates_four</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">outcome_four</span><span class="op">)</span></span></code></pre></div>
<p><img src="Covariates_and_outcomes_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jakub Nowosad.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
